name: autotunnel
services:
  autossh:
    image: oaklight/autossh-tunnel:latest
    ports:
      - "5002:5002" # Control API port
    volumes:
      - ~/.ssh:/home/myuser/.ssh:ro
      - ./config:/etc/autossh/config:rw
      - ./logs:/var/log/autossh:rw
    environment:
      - PUID=1000
      - PGID=1000
      - AUTOSSH_GATETIME=0
      - API_PORT=5002
    network_mode: "host"
    restart: always

  web:
    image: oaklight/autossh-tunnel-web-panel:latest
    ports:
      - "5000:5000"
    volumes:
      - ./config:/home/myuser/config
      - ./logs:/home/myuser/logs:ro
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Shanghai
      - AUTOSSH_API_URL=http://127.0.0.1:5002
    network_mode: "host"
    restart: always
